<div class="join-card">
  <div class="join-header">
	<button class="jb-btn" type="button" (click)="goBackToMain()">Back</button>
	<h2>Join Backups</h2>
	<div class="join-header-spacer"></div>
  </div>
  <div class="join-subtitle">Add multiple SMS Backup & Restore XML files, then merge into one.</div>
  <div class="controls">
	<input type="file" id="fileInput" (change)="onBrowserFileInputChange($event)" multiple accept=".xml" />
	<label class="jb-btn" for="fileInput">Add files</label>
	<button class="jb-btn" type="button" (click)="addFilesNative()">Add files</button>
	<button class="jb-btn" type="button" (click)="clearAll()">Clear</button>
	<button class="jb-btn jb-btn--primary" type="button" (click)="mergeAndSave()">Merge & Save</button>
  </div>

  <div class="preview">
    <div><strong>Files:</strong> {{ preview.files }}</div>
    <div><strong>Messages (est):</strong> {{ preview.messages }}</div>
    <div><strong>Contacts (est):</strong> {{ preview.contacts }}</div>
  </div>

  <div class="file-list">
	<h3 class="file-list-title">Added files</h3>
	<div *ngIf="!selectedFiles.length" class="file-list-empty">No files added yet.</div>
    <ul>
      <li *ngFor="let f of selectedFiles; let i = index">
        <div class="file-line">
          <span class="file-title">{{i+1}}. {{ f.name }} ({{ f.size | number }} bytes)</span>

          <span *ngIf="f.readError || f.text === undefined" class="file-bad">
            <span *ngIf="f.reading">Reading...</span>
            <span *ngIf="!f.reading">Unreadable</span>
			<button class="jb-btn jb-btn--sm" type="button" (click)="retryRead(i)" [disabled]="f.reading">Retry</button>
            <span class="file-bad-msg" *ngIf="f.readError">{{ f.readError }}</span>
          </span>

          <div class="file-actions">
      <button class="jb-btn jb-btn--sm" type="button" (click)="toggleDetails(i)">{{ f.expanded ? 'Hide' : 'Details' }}</button>
      <button class="jb-btn jb-btn--sm" type="button" (click)="removeFile(i)">Remove</button>
          </div>
        </div>

        <div class="file-details" *ngIf="f.expanded">
          <div><strong>Path:</strong> {{ f.path || 'â€”' }}</div>
          <div><strong>Size:</strong> {{ f.size }} bytes</div>
          <div *ngIf="f.details">
            <div><strong>Messages:</strong> {{ f.details.messages }}</div>
            <div><strong>Contacts:</strong> {{ f.details.contacts }}</div>
            <pre class="file-sample" *ngIf="f.details.sample">{{ f.details.sample }}</pre>
            <div class="parse-error" *ngIf="f.details.parseError">Parse error: {{ f.details.parseError }}</div>
          </div>
          <div *ngIf="!f.details && f.text">Parsing...</div>
          <div *ngIf="!f.text">No content to show</div>
        </div>
      </li>
    </ul>
  </div>

  <div class="status">{{ status }}</div>
</div>