<div class="settings-container">
    <div class="settings-card mdl-card mdl-shadow--2dp">
        <div class="mdl-card__title">
            <h2 class="mdl-card__title-text">Settings</h2>
        </div>
        <div class="mdl-card__supporting-text">
            <p class="settings-description">These settings affect how the backup file is processed.</p>
            <div class="country-select-wrapper">
                <h3 class="setting-label">Country Code</h3>
                <p class="setting-help">Select your country to properly format phone numbers.</p>
                <country-select></country-select>
            </div>

            <hr />
            <h3 class="setting-label">Storage (IndexedDB)</h3>
            <p class="setting-help">Persist imported messages locally so reloads are instant. Recommended for large imports.</p>
            <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" style="display: inline-flex; align-items: center; gap: 10px;">
                <input
                    type="checkbox"
                    class="mdl-switch__input"
                    [(ngModel)]="indexedDbEnabled"
                    (change)="onIndexedDbEnabledChanged()" />
                <span class="mdl-switch__label">Enable IndexedDB persistence</span>
            </label>
            <div class="setting-help" style="margin-top: 10px;">
                Stored conversations: {{ dbThreadCount.toLocaleString() }}<br />
                Stored messages: {{ dbMessageCount.toLocaleString() }}
            </div>
            <div class="button-row" style="margin-top: 12px;">
                <button
                    class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect"
                    (click)="refreshDbStats()">
                    Refresh storage stats
                </button>
                <button
                    class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect"
                    (click)="clearIndexedDb()"
                    [disabled]="clearingDb">
                    Clear stored data
                </button>
            </div>

            <hr />
            <h3 class="setting-label">Export</h3>
            <p class="setting-help">Download the currently loaded data as CSV.</p>
            <div class="button-row">
                <button
                    class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect"
                    (click)="exportAllMessages()"
                    [disabled]="!messagesLoaded">
                    Export Messages CSV
                </button>
                <button
                    class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect"
                    (click)="exportContacts()"
                    [disabled]="!messagesLoaded">
                    Export Contacts CSV
                </button>
            </div>
        </div>
        <div class="mdl-card__actions mdl-card--border">
            <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect" routerLink="/main" routerLinkActive="active">
                Back to Main
            </button>
        </div>
    </div>
</div>